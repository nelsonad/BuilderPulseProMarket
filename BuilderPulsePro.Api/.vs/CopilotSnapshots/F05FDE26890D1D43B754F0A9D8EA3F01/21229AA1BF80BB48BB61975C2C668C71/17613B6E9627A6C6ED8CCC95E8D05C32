using BuilderPulsePro.Api.Notifications;

namespace BuilderPulsePro.Api.Endpoints;

public static class AdminEndpoints
{
    public static IEndpointRouteBuilder MapAdminEndpoints(this IEndpointRouteBuilder app)
    {
        var group = app.MapGroup("/admin/notifications")
            .WithTags("Admin")
            .RequireAuthorization();

        group.MapPost("/job-digest/run", RunJobDigest);

        return app;
    }

    private static async Task<IResult> RunJobDigest(JobDigestRunner runner, CancellationToken ct)
    {
        var result = await runner.RunOnceAsync(ct);
        return Results.Ok(result);
    }
}
